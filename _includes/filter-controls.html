<!-- Unified Filter & Control Bar -->
<div class="filter-bar" x-data="filterControls()">
  <!-- Primary Row: Search + Severity + Sort -->
  <div class="filter-bar__row filter-bar__row--primary">
    <!-- Search (primary action, expandable) -->
    <div class="filter-bar__item filter-bar__item--search">
      <input 
        type="text" 
        id="search-input"
        class="input" 
        placeholder="ğŸ” Search restaurants..." 
        x-model="searchQuery"
        @input="applyFilters"
        aria-label="Search restaurants by name">
    </div>
    
    <!-- Severity pills (visual, immediate) -->
    <div class="filter-bar__item">
      <div class="severity-pills">
        <button 
          @click="toggleSeverity('high')" 
          :class="{ 'active': selectedSeverity.includes('high') }"
          class="severity-pill severity-pill--high"
          aria-label="Filter by high severity"
          :title="`High severity ${selectedSeverity.includes('high') ? '(active)' : ''}`">
          ğŸ”´
        </button>
        <button 
          @click="toggleSeverity('medium')" 
          :class="{ 'active': selectedSeverity.includes('medium') }"
          class="severity-pill severity-pill--medium"
          aria-label="Filter by medium severity"
          :title="`Medium severity ${selectedSeverity.includes('medium') ? '(active)' : ''}`">
          ğŸŸ 
        </button>
        <button 
          @click="toggleSeverity('low')" 
          :class="{ 'active': selectedSeverity.includes('low') }"
          class="severity-pill severity-pill--low"
          aria-label="Filter by low severity"
          :title="`Low severity ${selectedSeverity.includes('low') ? '(active)' : ''}`">
          ğŸŸ¡
        </button>
      </div>
    </div>
    
    <!-- Sort dropdown (compact) -->
    <div class="filter-bar__item">
      <select 
        x-model="sortBy" 
        @change="changeSortOrder" 
        class="select select--compact"
        aria-label="Sort results">
        <option value="severity">â†“ Severity</option>
        <option value="date">â†“ Recent</option>
        <option value="name">Aâ†’Z Name</option>
      </select>
    </div>
  </div>
  
  <!-- Secondary Row: Refinements + Actions -->
  <div class="filter-bar__row filter-bar__row--secondary">
    <!-- Date dropdown -->
    <div class="filter-bar__item">
      <select 
        x-model="dateRange" 
        @change="applyFilters" 
        class="select select--compact"
        aria-label="Select date range">
        <option value="all">ğŸ“… All time</option>
        <option value="30">Last 30 days</option>
        <option value="90">Last 90 days</option>
        <option value="180">Last 6 months</option>
        <option value="365">Last year</option>
      </select>
    </div>
    
    <!-- City dropdown -->
    <div class="filter-bar__item">
      <select 
        x-model="cityFilter" 
        @change="handleCityFilter" 
        class="select select--compact"
        aria-label="Filter by city">
        <option value="">ğŸ™ï¸ All cities</option>
        <template x-for="city in cities" :key="city">
          <option :value="city" x-text="city"></option>
        </template>
      </select>
    </div>
    
    <!-- Spacer to push right-side content -->
    <div style="flex: 1;"></div>
    
    <!-- Results count (prominent feedback) -->
    <div class="filter-bar__item">
      <span class="results-count" x-text="`${resultsCount} result${resultsCount !== 1 ? 's' : ''}`"></span>
    </div>
    
    <!-- Export menu (progressive disclosure) -->
    <div class="filter-bar__item" x-data="{ exportOpen: false }">
      <div style="position: relative;">
        <button 
          @click="exportOpen = !exportOpen"
          class="btn btn--small btn--secondary"
          aria-label="Export options"
          aria-expanded="exportOpen">
          ğŸ“¥ Export
        </button>
        
        <div 
          x-show="exportOpen" 
          @click.outside="exportOpen = false"
          class="export-menu"
          x-transition>
          <button @click="exportToCSV(); exportOpen = false" class="export-menu__item">
            ğŸ“„ CSV
          </button>
          <button @click="exportToJSON(); exportOpen = false" class="export-menu__item">
            ğŸ”§ JSON
          </button>
        </div>
      </div>
    </div>
    
    <!-- Clear filters (only when active) -->
    <div class="filter-bar__item" x-show="activeFilterCount > 0" x-transition>
      <button 
        @click="resetFilters" 
        class="btn btn--small"
        style="background: transparent; color: #f57c00; border: 1px solid #f57c00;"
        aria-label="Clear all filters"
        :title="`Clear ${activeFilterCount} active filter${activeFilterCount !== 1 ? 's' : ''}`">
        âœ• Clear
      </button>
    </div>
  </div>
</div>
