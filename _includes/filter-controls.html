<!-- Mobile Filter Button (only visible on mobile) -->
<div class="mobile-filter-trigger" x-data="{ mobileFiltersOpen: false }">
  <!-- Mobile Search (always visible) -->
  <div class="mobile-search" x-data="filterControls()">
    <input 
      type="text" 
      class="input" 
      placeholder="ðŸ” Search restaurants..." 
      x-model="searchQuery"
      @input="applyFilters"
      aria-label="Search restaurants by name">
  </div>

  <button 
    @click="mobileFiltersOpen = true"
    class="btn mobile-filter-btn"
    aria-label="Open filters">
    <span>Filters & Sort</span>
    <span class="mobile-filter-btn__badge" x-data="filterControls()" x-show="activeFilterCount > 0" x-text="activeFilterCount"></span>
  </button>

  <!-- Mobile Filter Drawer (bottom sheet) -->
  <div 
    class="mobile-filter-drawer"
    :class="{ 'mobile-filter-drawer--open': mobileFiltersOpen }"
    x-show="mobileFiltersOpen"
    @click.self="mobileFiltersOpen = false"
    x-transition>
    
    <div class="mobile-filter-drawer__content">
      
      <div class="mobile-filter-drawer__header">
        <h2>Filters & Sort</h2>
        <button 
          @click="mobileFiltersOpen = false" 
          class="mobile-filter-drawer__close"
          aria-label="Close filters">
          âœ•
        </button>
      </div>
      
      <div class="mobile-filter-drawer__body" x-data="filterControls()">
        <!-- All filter controls in mobile drawer -->
        <div class="mobile-filter-group">
          <label class="mobile-filter-label">Severity</label>
          <div class="severity-pills severity-pills--mobile-container">
            <button 
              @click="toggleSeverity('high')" 
              :class="{ 'active': selectedSeverity.includes('high') }"
              class="severity-pill severity-pill--high severity-pill--mobile">
              ðŸ”´ High
            </button>
            <button 
              @click="toggleSeverity('medium')" 
              :class="{ 'active': selectedSeverity.includes('medium') }"
              class="severity-pill severity-pill--medium severity-pill--mobile">
              ðŸŸ  Med
            </button>
            <button 
              @click="toggleSeverity('low')" 
              :class="{ 'active': selectedSeverity.includes('low') }"
              class="severity-pill severity-pill--low severity-pill--mobile">
              ðŸŸ¡ Low
            </button>
          </div>
        </div>

        <div class="mobile-filter-group">
          <label class="mobile-filter-label">Sort By</label>
          <select x-model="sortBy" @change="changeSortOrder" class="select">
            <option value="severity">Severity (High to Low)</option>
            <option value="date">Most Recent</option>
            <option value="name">Name (A-Z)</option>
          </select>
        </div>

        <div class="mobile-filter-group">
          <label class="mobile-filter-label">Date Range</label>
          <select x-model="dateRange" @change="applyFilters" class="select">
            <option value="all">All time</option>
            <option value="30">Last 30 days</option>
            <option value="90">Last 90 days</option>
            <option value="180">Last 6 months</option>
            <option value="365">Last year</option>
          </select>
        </div>



        <div class="mobile-filter-drawer__actions">
          <button @click="resetFilters" class="btn btn--secondary" style="flex: 1;">
            Clear Filters
          </button>
          <button @click="mobileFiltersOpen = false" class="btn" style="flex: 2;">
            Show <span x-text="resultsCount"></span> Results
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Unified Filter & Control Bar (desktop/tablet only) -->
<div class="filter-bar filter-bar--desktop" x-data="filterControls()">
  <!-- Primary Row: Search + Severity + Sort -->
  <div class="filter-bar__row filter-bar__row--primary">
    <!-- Search (primary action, expandable) -->
    <div class="filter-bar__item filter-bar__item--search">
      <input 
        type="text" 
        id="search-input"
        class="input" 
        placeholder="ðŸ” Search restaurants..." 
        x-model="searchQuery"
        @input="applyFilters"
        aria-label="Search restaurants by name">
    </div>
    
    <!-- Severity pills (visual, immediate) -->
    <div class="filter-bar__item">
      <div class="severity-pills">
        <button 
          @click="toggleSeverity('high')" 
          :class="{ 'active': selectedSeverity.includes('high') }"
          class="severity-pill severity-pill--high"
          aria-label="Filter by high severity"
          :title="`High severity ${selectedSeverity.includes('high') ? '(active)' : ''}`">
          ðŸ”´
        </button>
        <button 
          @click="toggleSeverity('medium')" 
          :class="{ 'active': selectedSeverity.includes('medium') }"
          class="severity-pill severity-pill--medium"
          aria-label="Filter by medium severity"
          :title="`Medium severity ${selectedSeverity.includes('medium') ? '(active)' : ''}`">
          ðŸŸ 
        </button>
        <button 
          @click="toggleSeverity('low')" 
          :class="{ 'active': selectedSeverity.includes('low') }"
          class="severity-pill severity-pill--low"
          aria-label="Filter by low severity"
          :title="`Low severity ${selectedSeverity.includes('low') ? '(active)' : ''}`">
          ðŸŸ¡
        </button>
      </div>
    </div>
    
    <!-- Sort dropdown (compact) -->
    <div class="filter-bar__item">
      <select 
        x-model="sortBy" 
        @change="changeSortOrder" 
        class="select select--compact"
        aria-label="Sort results">
        <option value="severity">â†“ Severity</option>
        <option value="date">â†“ Recent</option>
        <option value="name">Aâ†’Z Name</option>
      </select>
    </div>
  </div>
  
  <!-- Secondary Row: Refinements + Actions -->
  <div class="filter-bar__row filter-bar__row--secondary">
    <!-- Date dropdown -->
    <div class="filter-bar__item">
      <select 
        x-model="dateRange" 
        @change="applyFilters" 
        class="select select--compact"
        aria-label="Select date range">
        <option value="all">ðŸ“… All time</option>
        <option value="30">Last 30 days</option>
        <option value="90">Last 90 days</option>
        <option value="180">Last 6 months</option>
        <option value="365">Last year</option>
      </select>
    </div>
    

    
    <!-- Spacer to push right-side content -->
    <div style="flex: 1;"></div>
    
    <!-- Results count (prominent feedback) -->
    <div class="filter-bar__item">
      <span class="results-count" x-text="`${resultsCount} result${resultsCount !== 1 ? 's' : ''}`"></span>
    </div>
    
    <!-- Export menu (progressive disclosure) -->
    <div class="filter-bar__item" x-data="{ exportOpen: false }">
      <div style="position: relative;">
        <button 
          @click="exportOpen = !exportOpen"
          class="btn btn--small btn--secondary"
          aria-label="Export options"
          aria-expanded="exportOpen">
          ðŸ“¥ Export
        </button>
        
        <div 
          x-show="exportOpen" 
          @click.outside="exportOpen = false"
          class="export-menu"
          x-transition>
          <button @click="exportToCSV(); exportOpen = false" class="export-menu__item">
            ðŸ“„ CSV
          </button>
          <button @click="exportToJSON(); exportOpen = false" class="export-menu__item">
            ðŸ”§ JSON
          </button>
        </div>
      </div>
    </div>
    
    <!-- Clear filters (only when active) -->
    <div class="filter-bar__item" x-show="activeFilterCount > 0" x-transition>
      <button 
        @click="resetFilters" 
        class="btn btn--small"
        style="background: transparent; color: #f57c00; border: 1px solid #f57c00;"
        aria-label="Clear all filters"
        :title="`Clear ${activeFilterCount} active filter${activeFilterCount !== 1 ? 's' : ''}`">
        âœ• Clear
      </button>
    </div>
  </div>
</div>
