---
layout: default
title: ABQ Health Code Violations
---

<div class="page-title">
  <p class="page-title__subtitle">
    Find restaurants with recent health code violations in Albuquerque
  </p>
</div>

<!-- Status Key (always visible) -->
<div class="status-key">
  <div class="status-key__item">
    <span class="status-key__label">Conditional:</span> Operating w/ violations
  </div>
  <div class="status-key__item">
    <span class="status-key__label">Unsatisfactory:</span> Re-inspection needed
  </div>
  <div class="status-key__item">
    <span class="status-key__label">Closure:</span> Must close to reopen
  </div>
  <div class="status-key__item status-key__item--closed">
    <span class="status-key__label">CLOSED:</span> Not operating
  </div>
</div>

<!-- Unified Filter & Control Bar -->
{% include filter-controls.html %}

<!-- Violations List -->
<div class="violations" x-data="violationsList()" x-init="$store.violations.init()">
  <!-- Loading State -->
  <template x-if="loading">
    <div class="empty-state">
      <div class="empty-state__icon">‚è≥</div>
      <h3 class="empty-state__message">Loading violations...</h3>
    </div>
  </template>
  
  <!-- Error State -->
  <template x-if="error && !loading">
    <div class="empty-state">
      <div class="empty-state__icon">‚ö†Ô∏è</div>
      <h3 class="empty-state__message">Failed to load data</h3>
      <p class="empty-state__hint" x-text="error"></p>
      <p class="empty-state__hint">
        The data pipeline hasn't run yet. Check back once the data is populated.
      </p>
    </div>
  </template>
  
  <!-- Empty State (no results) -->
  <template x-if="!loading && !error && violations.length === 0">
    <div class="empty-state">
      <div class="empty-state__icon">üîç</div>
      <h3 class="empty-state__message">No violations found</h3>
      <p class="empty-state__hint">Try adjusting your filters</p>
    </div>
  </template>
  
  <!-- Restaurant Cards -->
  <template x-for="restaurant in violations" :key="`${restaurant.name}-${restaurant.address}`">
    <article class="restaurant-card">
      <!-- Restaurant Header -->
      <div class="restaurant-card__header">
        <div>
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
            <h3 class="restaurant-card__title" x-text="restaurant.name"></h3>
            <template x-if="restaurant.isClosed">
              <span class="status-tag status-tag--closed">CLOSED</span>
            </template>
          </div>
          <p class="restaurant-card__address" x-text="`${restaurant.address}, ${restaurant.city}`"></p>
          <p class="restaurant-card__score" x-text="`Score: ${restaurant.score.toFixed(1)}`"></p>
        </div>
        <span 
          class="badge"
          :class="`badge--${getSeverityLevel(restaurant.score)}`"
          x-text="getSeverityLevel(restaurant.score).toUpperCase()">
        </span>
      </div>
      
      <!-- Per-Inspection Accordions -->
      <div class="inspections-list">
        <template x-for="(inspection, index) in restaurant.inspections" :key="`${restaurant.name}-${inspection.date}-${inspection.outcome}-${index}`">
          <div x-data="{ open: false, get hasContent() { return (inspection.violations && inspection.violations.length > 0) || inspection.writeup } }">
            <template x-if="hasContent">
              <div class="inspection-accordion">
                <button 
                  class="inspection-accordion__trigger"
                  @click="open = !open"
                  :aria-expanded="open.toString()">
                  <span class="inspection-accordion__summary" x-text="formatInspectionHeading(inspection, restaurant.inspections)"></span>
                  <span class="inspection-accordion__icon" :class="{ 'inspection-accordion__icon--open': open }">‚ñæ</span>
                </button>
                
                <div class="inspection-accordion__panel" x-show="open" x-transition.opacity>
                  <p class="inspection-accordion__writeup" x-text="generateInspectionWriteup(inspection)"></p>
                </div>
              </div>
            </template>
            <template x-if="!hasContent">
              <div class="inspection-item">
                <span class="inspection-accordion__summary" x-text="formatInspectionHeading(inspection, restaurant.inspections)"></span>
              </div>
            </template>
          </div>
        </template>
      </div>
    </article>
  </template>
</div>
